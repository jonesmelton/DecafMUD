<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Discworld MUD on DecafMUD Client</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <script src="js/mudpipe.js" type="text/javascript"></script>
    <script src="js/disc.settings.js" type="text/javascript"></script>
    <script src="js/dragelement.js" type="text/javascript"></script>
    <script src="js/disc.menu.js" type="text/javascript"></script>
    <script src="js/disc.macro.js" type="text/javascript"></script>
    <script src="js/disc.zmp.js" type="text/javascript"></script>
    <script src="js/decafmud.js" type="text/javascript"></script>
    <script
      src="js/decafmud.storage.standard.js"
      type="text/javascript"
    ></script>
    <script
      src="js/decafmud.interface.discworld.js"
      type="text/javascript"
    ></script>
    <script src="js/decafmud.encoding.cp437.js" type="text/javascript"></script>
    <script src="main.js"></script>
  </head>
  <body>
    <div id="elm_mud"></div>
    ;

    <script type="text/javascript">
      var decaf, el, timer;

      window.onload = function () {
        const address = "discworld.starturtle.net";

        // dummy div for the old client
        const decafmud_dom_element = document.createElement("div");
        decafmud_dom_element.id = "mud";

        // real div for the new client
        var app = Elm.Main.init({
          node: document.getElementById("elm_mud"),
        });

        var MP = new MudPipe();
        window.elmToMud = app.ports.sendToMud;
        MP.setPorts(app.ports);

        console.log("app?: ", app);
        var options = {
          pipe: MP,
          set_interface: {
            container: decafmud_dom_element,
            start_full: true,
          },
          set_socket: {
            wspath: "menu",
            wsport: 4243,
          },
          host: address,
          port: 4242,
          autoreconnect: false,
          socket: "websocket",
          plugins: ["telopt.zmp"],
        };

        decaf = new DecafMUD(options);
        timer = setTimeout(checkTest, 50);
      };

      var req = new XMLHttpRequest();

      function checkTest() {
        clearTimeout(timer);
        if (decaf.loaded !== true) {
          // Wait longer.
          timer = setTimeout(checkTest, 50);
          return;
        }
      }

      // console.log("in body: ", MP);
    </script>
  </body>
</html>
